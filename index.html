<!DOCTYPE html>
<html lang="kk">
<head>
  <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
      <title>TaskGen AI — Қауіпсіз Q&A Генераторы</title>
        <style>
            :root{ --bg:#0b1220; --panel:#0f172a; --ink:#e5e7eb; --muted:#9ca3af; --line:#1f2937; --acc:#22d3ee; --ok:#34d399; --warn:#f59e0b; --err:#ef4444 }
                html,body{margin:0;height:100%;background:var(--bg);color:var(--ink);font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial}
                    .wrap{max-width:1100px;margin:28px auto;padding:0 16px}
                        h1{font-size:28px;margin:0 0 6px}
                            .muted{color:var(--muted)}
                                .card{background:linear-gradient(180deg,#0b1220,#0b1220 60%,#0f172a);border:1px solid var(--line);border-radius:16px;padding:16px;box-shadow:0 8px 28px rgba(0,0,0,.25)}
                                    .grid{display:grid;gap:12px}
                                        @media(min-width:900px){.grid{grid-template-columns:1.1fr .9fr}}
                                            label{display:block;font-size:12px;color:var(--muted);margin-bottom:6px}
                                                input,select{width:100%;background:#0a1020;border:1px solid var(--line);border-radius:12px;color:var(--ink);padding:10px 12px;outline:none}
                                                    .row{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}
                                                        .btn{appearance:none;border:1px solid var(--line);background:#111827;color:var(--ink);padding:10px 14px;border-radius:12px;cursor:pointer}
                                                            .btn:hover{border-color:#334155}
                                                                .btn.primary{background:linear-gradient(90deg,#0891b2,#06b6d4);border:0;color:#001018;font-weight:600}
                                                                    .tag{display:inline-block;padding:.12rem .5rem;border-radius:999px;border:1px solid #334155;color:#93c5fd;font-size:12px;margin-left:6px}
                                                                        .tasks .item{border:1px solid var(--line);border-radius:12px;padding:12px;margin:10px 0;background:#0b1020}
                                                                            .sep{height:1px;background:var(--line);margin:14px 0}
                                                                                .small{font-size:12px}
                                                                                    .err{color:var(--err)}
                                                                                      </style>
                                                                                      </head>
                                                                                      <body>
                                                                                        <div class="wrap">
                                                                                            <h1>TaskGen AI <span class="tag">secure serverless</span></h1>
                                                                                                <p class="muted small">Тақырыпты жазыңыз — ІІ сұрақтар мен жауаптарды жасайды. API кілт сервер жақта қорғалған.</p>

                                                                                                    <div class="grid">
                                                                                                          <div class="card">
                                                                                                                  <div class="row">
                                                                                                                            <div>
                                                                                                                                        <label>Тіл / Language</label>
                                                                                                                                                    <select id="lang">
                                                                                                                                                                  <option value="kk" selected>Қазақша</option>
                                                                                                                                                                                <option value="ru">Русский</option>
                                                                                                                                                                                              <option value="en">English</option>
                                                                                                                                                                                                          </select>
                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                              <div>
                                                                                                                                                                                                                                          <label>Түрі</label>
                                                                                                                                                                                                                                                      <select id="kind">
                                                                                                                                                                                                                                                                    <option value="quiz" selected>Quiz</option>
                                                                                                                                                                                                                                                                                  <option value="coding">Coding</option>
                                                                                                                                                                                                                                                                                                <option value="algorithm">Algorithm</option>
                                                                                                                                                                                                                                                                                                            </select>
                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                <div>
                                                                                                                                                                                                                                                                                                                                            <label>Деңгей</label>
                                                                                                                                                                                                                                                                                                                                                        <select id="level">
                                                                                                                                                                                                                                                                                                                                                                      <option value="easy">Easy</option>
                                                                                                                                                                                                                                                                                                                                                                                    <option value="medium" selected>Medium</option>
                                                                                                                                                                                                                                                                                                                                                                                                  <option value="hard">Hard</option>
                                                                                                                                                                                                                                                                                                                                                                                                              </select>
                                                                                                                                                                                                                                                                                                                                                                                                                        </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                        <div class="row" style="margin-top:12px">
                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                              <label>Тақырып атауы</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <input id="topic" placeholder="мысалы: Алгоритмдердің күрделілігі" />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <label>Сұрақ саны</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <input id="count" type="number" min="1" max="20" value="5" />
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <label>Жауап болсын ба?</label>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <select id="withAnswers">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <option value="yes" selected>Иә</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <option value="no">Жоқ</option>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          </select>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <div class="sep"></div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <button class="btn primary" id="btnGen">Генерациялау</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <button class="btn" id="btnDoc">DOC жүктеу</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <button class="btn" id="btnJson">JSON жүктеу</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    <button class="btn" id="btnPrint">PDF басып шығару</button>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              <span id="status" class="small muted"></span>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </div>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div class="card">
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <h3 style="margin:4px 0 8px">Нәтиже</h3>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div id="meta" class="small muted"></div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div class="sep"></div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  <div id="tasks" class="tasks"></div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          <div id="error" class="err small"></div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    </div>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </div>

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      <script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const API_BASE = "/api"; // мысалы: "/api" немесе "https://<your-worker>.workers.dev"
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const $ = (q)=>document.querySelector(q);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      const escapeHtml = (s)=>s.replace(/[&<>\"']/g, c=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[c]));
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      let LAST=null;

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      function buildPayload(){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          return {
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                language: $('#lang').value,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    kind: $('#kind').value,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        level: $('#level').value,
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            topic: $('#topic').value.trim(),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                count: Math.min(Math.max(1, +($('#count').value||5)), 20),
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    withAnswers: $('#withAnswers').value === 'yes'
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          };
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      function render(bundle){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          LAST=bundle; $('#error').textContent='';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            $('#meta').textContent = `Тақырып: ${bundle.topic} · Тіл: ${bundle.language} · Деңгей: ${bundle.requested_level} · Түрі: ${bundle.kind}`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const box=$('#tasks'); box.innerHTML='';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                bundle.tasks.forEach((t,i)=>{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const div=document.createElement('div'); div.className='item';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            div.innerHTML = `<h3 style="margin:0 0 6px">${i+1}. ${escapeHtml(t.question)}</h3>` +
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                (t.answer? `<p class="muted">Жауап:</p><p>${escapeHtml(t.answer)}</p>`: '');
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    box.appendChild(div);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      }

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      $('#btnGen').addEventListener('click', async ()=>{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          const payload=buildPayload();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if(!payload.topic){ $('#error').textContent='Тақырыпты жазыңыз.'; return; }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              $('#status').textContent='Генерациялануда...';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                try{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        const res = await fetch(`${API_BASE}/generate`, {method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(payload)});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            if(!res.ok){ throw new Error(`API ${res.status}`); }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                const data = await res.json();
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    render(data);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        $('#status').textContent='Дайын.';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }catch(err){
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        console.error(err); $('#error').textContent='Қате: '+err.message; $('#status').textContent='';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      $('#btnJson').addEventListener('click', ()=>{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if(!LAST){ alert('Алдымен генерациялаңыз.'); return; }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const blob=new Blob([JSON.stringify(LAST,null,2)], {type:'application/json'});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`${LAST.topic}_${LAST.language}.json`; a.click(); URL.revokeObjectURL(a.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      $('#btnDoc').addEventListener('click', ()=>{
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          if(!LAST){ alert('Алдымен генерациялаңыз.'); return; }
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            const b=LAST; const header=`<html><head><meta charset='utf-8'></head><body>`; const footer='</body></html>';
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              let html=`<h1>Тақырып: ${escapeHtml(b.topic)} (${escapeHtml(b.language)})</h1><p>Деңгей: ${escapeHtml(b.requested_level)} · Түрі: ${escapeHtml(b.kind)}</p>`;
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                b.tasks.forEach((t,i)=>{ html+=`<h2>${i+1}. Сұрақ</h2><p>${escapeHtml(t.question)}</p>`; if(t.answer) html+=`<p><b>Жауап:</b> ${escapeHtml(t.answer)}</p>`; });
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  const blob=new Blob([header+html+footer], {type:'application/msword'});
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                    const a=document.createElement('a'); a.href=URL.createObjectURL(blob); a.download=`${b.topic}_${b.language}.doc`; a.click(); URL.revokeObjectURL(a.href);
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      });

                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      $('#btnPrint').addEventListener('click', ()=>window.print());
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </script>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </body>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      </html>
